var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { PageDecorator, sleep } from '../utils.js';
import { WindowControls, ContextMenu } from '../index.js';
import { Menu } from './Menu.js';
import { MenuItem } from './MenuItem.js';
import { TitleBar as TitleBarLocators } from '../../locators/1.73.0.js';
/**
 * Page object representing the custom VSCode title bar
 *
 * @category Menu
 */
let TitleBar = class TitleBar extends Menu {
    constructor() {
        super(...arguments);
        /**
         * @private
         */
        this.locatorKey = 'TitleBar';
    }
    /**
     * Get title bar item by name
     * @param name name of the item to search by
     * @returns Promise resolving to TitleBarItem object
     */
    async getItem(name) {
        const all = await this.getItems();
        for (const item of all) {
            if (item.label === name) {
                return item;
            }
        }
        return undefined;
    }
    /**
     * Get all title bar items
     * @returns Promise resolving to array of TitleBarItem objects
     */
    async getItems() {
        // can't search in this. because in web version the overflow menu is in activity bar
        const menubar = await browser.$(this.locators.menubar);
        if (!(await menubar.isExisting())) {
            throw new Error('Menubar not found in TitleBar, this probably means you are using "native" Title Bar Style. '
                + 'Title Items can only be found when using "custom" style.');
        }
        const items = [];
        for (const element of await menubar.$$(this.locators.itemElement)) {
            const isDisplayed = await element.isDisplayed();
            if (!isDisplayed) {
                continue;
            }
            const label = await element.getAttribute(this.locators.itemLabel);
            if (label === 'More' // electron
                || label === 'Application Menu' // web
            ) {
                await element.click();
                const overflow = await new ContextMenu(this.locatorMap).wait();
                for (const overflowItem of await overflow.getItems()) {
                    const item = new TitleBarItem(this.locatorMap, this.locators.overflowItemConstructor, async (self) => {
                        await element.click(); // make sure the overflow menu is open
                        await self.elem.click();
                    }, await overflowItem.getLabel(), this);
                    await item.wait();
                    items.push(item);
                }
                await browser.keys('Escape');
            }
            else {
                const item = new TitleBarItem(this.locatorMap, this.locators.topLevelItemConstructor, async (self) => {
                    await self.elem.click();
                }, label, this);
                await item.wait();
                items.push(item);
            }
        }
        return items;
    }
    /**
     * Get the window title
     * @returns Promise resolving to the window title
     */
    async getTitle() {
        const title = await this.title$.getText();
        /**
         * when testing VSCode on the web the element is not
         * visible and the text will be "", therefor we need
         * to fetch the HTML
         */
        if (title.length === 0) {
            return this.title$.getHTML(false);
        }
        return title;
    }
    /**
     * Get a reference to the WindowControls
     */
    getWindowControls() {
        return new WindowControls(this.locatorMap, this.elem);
    }
};
TitleBar = __decorate([
    PageDecorator(TitleBarLocators)
], TitleBar);
export { TitleBar };
/**
 * Page object representing an item of the custom VSCode title bar
 *
 * @category Menu
 */
let TitleBarItem = class TitleBarItem extends MenuItem {
    constructor(locators, ctor, openMenu, label, parentMenu) {
        super(locators, ctor(label));
        this.openMenu = openMenu;
        this.label = label;
        this.parentMenu = parentMenu;
        /**
         * @private
         */
        this.locatorKey = 'TitleBar';
    }
    async select() {
        const openMenus = await browser.$$(this.locatorMap.ContextMenu.elem);
        if (openMenus.length > 0 && await openMenus[0].isDisplayed()) {
            await browser.keys('Escape');
        }
        await this.openMenu(this);
        await sleep(500);
        const menu = new ContextMenu(this.locatorMap, this.elem);
        await menu.wait();
        return menu;
    }
};
TitleBarItem = __decorate([
    PageDecorator(TitleBarLocators)
], TitleBarItem);
export { TitleBarItem };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGl0bGVCYXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvbWVudS9UaXRsZUJhci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQSxPQUFPLEVBQ0gsYUFBYSxFQUFvQyxLQUFLLEVBQ3pELE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFBRSxjQUFjLEVBQUUsV0FBVyxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBQ3pELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxXQUFXLENBQUE7QUFDaEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQUN4QyxPQUFPLEVBQUUsUUFBUSxJQUFJLGdCQUFnQixFQUFFLE1BQU0sMEJBQTBCLENBQUE7QUFHdkU7Ozs7R0FJRztBQUVJLElBQU0sUUFBUSxHQUFkLE1BQU0sUUFBUyxTQUFRLElBQTZCO0lBQXBEOztRQUNIOztXQUVHO1FBQ0ksZUFBVSxHQUFHLFVBQW1CLENBQUE7SUFxRzNDLENBQUM7SUFuR0c7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxPQUFPLENBQUUsSUFBWTtRQUN2QixNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQTtRQUNqQyxLQUFLLE1BQU0sSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ3JCLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLEVBQUUsQ0FBQztnQkFDdEIsT0FBTyxJQUFJLENBQUE7WUFDZixDQUFDO1FBQ0wsQ0FBQztRQUNELE9BQU8sU0FBUyxDQUFBO0lBQ3BCLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsUUFBUTtRQUNWLG9GQUFvRjtRQUNwRixNQUFNLE9BQU8sR0FBRyxNQUFNLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUN0RCxJQUFJLENBQUMsQ0FBQyxNQUFNLE9BQU8sQ0FB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Iiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBQYWdlRGVjb3JhdG9yLCBJUGFnZURlY29yYXRvciwgVlNDb2RlTG9jYXRvck1hcCwgc2xlZXBcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQgeyBXaW5kb3dDb250cm9scywgQ29udGV4dE1lbnUgfSBmcm9tICcuLi9pbmRleC5qcydcbmltcG9ydCB7IE1lbnUgfSBmcm9tICcuL01lbnUuanMnXG5pbXBvcnQgeyBNZW51SXRlbSB9IGZyb20gJy4vTWVudUl0ZW0uanMnXG5pbXBvcnQgeyBUaXRsZUJhciBhcyBUaXRsZUJhckxvY2F0b3JzIH0gZnJvbSAnLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuXG5leHBvcnQgaW50ZXJmYWNlIFRpdGxlQmFyIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIFRpdGxlQmFyTG9jYXRvcnM+IHt9XG4vKipcbiAqIFBhZ2Ugb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY3VzdG9tIFZTQ29kZSB0aXRsZSBiYXJcbiAqXG4gKiBAY2F0ZWdvcnkgTWVudVxuICovXG5AUGFnZURlY29yYXRvcihUaXRsZUJhckxvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIFRpdGxlQmFyIGV4dGVuZHMgTWVudTx0eXBlb2YgVGl0bGVCYXJMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVGl0bGVCYXInIGFzIGNvbnN0XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGl0bGUgYmFyIGl0ZW0gYnkgbmFtZVxuICAgICAqIEBwYXJhbSBuYW1lIG5hbWUgb2YgdGhlIGl0ZW0gdG8gc2VhcmNoIGJ5XG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gVGl0bGVCYXJJdGVtIG9iamVjdFxuICAgICAqL1xuICAgIGFzeW5jIGdldEl0ZW0gKG5hbWU6IHN0cmluZyk6IFByb21pc2U8VGl0bGVCYXJJdGVtIHwgdW5kZWZpbmVkPiB7XG4gICAgICAgIGNvbnN0IGFsbCA9IGF3YWl0IHRoaXMuZ2V0SXRlbXMoKVxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgYWxsKSB7XG4gICAgICAgICAgICBpZiAoaXRlbS5sYWJlbCA9PT0gbmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBpdGVtXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgdGl0bGUgYmFyIGl0ZW1zXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYXJyYXkgb2YgVGl0bGVCYXJJdGVtIG9iamVjdHNcbiAgICAgKi9cbiAgICBhc3luYyBnZXRJdGVtcyAoKTogUHJvbWlzZTxUaXRsZUJhckl0ZW1bXT4ge1xuICAgICAgICAvLyBjYW4ndCBzZWFyY2ggaW4gdGhpcy4gYmVjYXVzZSBpbiB3ZWIgdmVyc2lvbiB0aGUgb3ZlcmZsb3cgbWVudSBpcyBpbiBhY3Rpdml0eSBiYXJcbiAgICAgICAgY29uc3QgbWVudWJhciA9IGF3YWl0IGJyb3dzZXIuJCh0aGlzLmxvY2F0b3JzLm1lbnViYXIpXG4gICAgICAgIGlmICghKGF3YWl0IG1lbnViYXIuaXNFeGlzdGluZygpKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICAgICAgICdNZW51YmFyIG5vdCBmb3VuZCBpbiBUaXRsZUJhciwgdGhpcyBwcm9iYWJseSBtZWFucyB5b3UgYXJlIHVzaW5nIFwibmF0aXZlXCIgVGl0bGUgQmFyIFN0eWxlLiAnXG4gICAgICAgICAgICAgICAgKyAnVGl0bGUgSXRlbXMgY2FuIG9ubHkgYmUgZm91bmQgd2hlbiB1c2luZyBcImN1c3RvbVwiIHN0eWxlLidcbiAgICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGl0ZW1zOiBUaXRsZUJhckl0ZW1bXSA9IFtdXG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBhd2FpdCBtZW51YmFyLiQkKHRoaXMubG9jYXRvcnMuaXRlbUVsZW1lbnQpKSB7XG4gICAgICAgICAgICBjb25zdCBpc0Rpc3BsYXllZCA9IGF3YWl0IGVsZW1lbnQuaXNEaXNwbGF5ZWQoKVxuICAgICAgICAgICAgaWYgKCFpc0Rpc3BsYXllZCkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBsYWJlbCA9IGF3YWl0IGVsZW1lbnQuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuaXRlbUxhYmVsKVxuICAgICAgICAgICAgaWYgKFxuICAgICAgICAgICAgICAgIGxhYmVsID09PSAnTW9yZScgLy8gZWxlY3Ryb25cbiAgICAgICAgICAgICAgICB8fCBsYWJlbCA9PT0gJ0FwcGxpY2F0aW9uIE1lbnUnIC8vIHdlYlxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgZWxlbWVudC5jbGljaygpXG4gICAgICAgICAgICAgICAgY29uc3Qgb3ZlcmZsb3cgPSBhd2FpdCBuZXcgQ29udGV4dE1lbnUodGhpcy5sb2NhdG9yTWFwKS53YWl0KClcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG92ZXJmbG93SXRlbSBvZiBhd2FpdCBvdmVyZmxvdy5nZXRJdGVtcygpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBuZXcgVGl0bGVCYXJJdGVtKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdG9yTWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMubG9jYXRvcnMub3ZlcmZsb3dJdGVtQ29uc3RydWN0b3IgYXMgRnVuY3Rpb24pLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXN5bmMgKHNlbGYpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBlbGVtZW50LmNsaWNrKCkgLy8gbWFrZSBzdXJlIHRoZSBvdmVyZmxvdyBtZW51IGlzIG9wZW5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmVsZW0uY2xpY2soKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IG92ZXJmbG93SXRlbS5nZXRMYWJlbCgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGl0ZW0ud2FpdCgpXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goaXRlbSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKCdFc2NhcGUnKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtID0gbmV3IFRpdGxlQmFySXRlbShcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdG9yTWFwLFxuICAgICAgICAgICAgICAgICAgICAodGhpcy5sb2NhdG9ycy50b3BMZXZlbEl0ZW1Db25zdHJ1Y3RvciBhcyBGdW5jdGlvbiksXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jIChzZWxmKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmVsZW0uY2xpY2soKVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBsYWJlbCxcbiAgICAgICAgICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICBhd2FpdCBpdGVtLndhaXQoKVxuICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2goaXRlbSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaXRlbXNcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIHdpbmRvdyB0aXRsZVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSB3aW5kb3cgdGl0bGVcbiAgICAgKi9cbiAgICBhc3luYyBnZXRUaXRsZSAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgdGl0bGUgPSBhd2FpdCB0aGlzLnRpdGxlJC5nZXRUZXh0KClcblxuICAgICAgICAvKipcbiAgICAgICAgICogd2hlbiB0ZXN0aW5nIFZTQ29kZSBvbiB0aGUgd2ViIHRoZSBlbGVtZW50IGlzIG5vdFxuICAgICAgICAgKiB2aXNpYmxlIGFuZCB0aGUgdGV4dCB3aWxsIGJlIFwiXCIsIHRoZXJlZm9yIHdlIG5lZWRcbiAgICAgICAgICogdG8gZmV0Y2ggdGhlIEhUTUxcbiAgICAgICAgICovXG4gICAgICAgIGlmICh0aXRsZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRpdGxlJC5nZXRIVE1MKGZhbHNlKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRpdGxlXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IGEgcmVmZXJlbmNlIHRvIHRoZSBXaW5kb3dDb250cm9sc1xuICAgICAqL1xuICAgIGdldFdpbmRvd0NvbnRyb2xzICgpOiBXaW5kb3dDb250cm9scyB7XG4gICAgICAgIHJldHVybiBuZXcgV2luZG93Q29udHJvbHModGhpcy5sb2NhdG9yTWFwLCB0aGlzLmVsZW0pXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRpdGxlQmFySXRlbSBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBUaXRsZUJhckxvY2F0b3JzPiB7fVxuLyoqXG4gKiBQYWdlIG9iamVjdCByZXByZXNlbnRpbmcgYW4gaXRlbSBvZiB0aGUgY3VzdG9tIFZTQ29kZSB0aXRsZSBiYXJcbiAqXG4gKiBAY2F0ZWdvcnkgTWVudVxuICovXG5AUGFnZURlY29yYXRvcihUaXRsZUJhckxvY2F0b3JzKVxuZXhwb3J0IGNsYXNzIFRpdGxlQmFySXRlbSBleHRlbmRzIE1lbnVJdGVtPHR5cGVvZiBUaXRsZUJhckxvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdUaXRsZUJhcicgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIGN0b3I6IEZ1bmN0aW9uLFxuICAgICAgICBwcml2YXRlIG9wZW5NZW51OiAoc2VsZjogVGl0bGVCYXJJdGVtKSA9PiBQcm9taXNlPHZvaWQ+LFxuICAgICAgICBwdWJsaWMgbGFiZWw6IHN0cmluZyxcbiAgICAgICAgcHVibGljIHBhcmVudE1lbnU6IE1lbnU8dHlwZW9mIFRpdGxlQmFyTG9jYXRvcnM+XG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzLCBjdG9yKGxhYmVsKSBhcyBzdHJpbmcpXG4gICAgfVxuXG4gICAgYXN5bmMgc2VsZWN0ICgpIHtcbiAgICAgICAgY29uc3Qgb3Blbk1lbnVzID0gYXdhaXQgYnJvd3Nlci4kJCh0aGlzLmxvY2F0b3JNYXAuQ29udGV4dE1lbnUuZWxlbSBhcyBzdHJpbmcpXG4gICAgICAgIGlmIChvcGVuTWVudXMubGVuZ3RoID4gMCAmJiBhd2FpdCBvcGVuTWVudXNbMF0uaXNEaXNwbGF5ZWQoKSkge1xuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci5rZXlzKCdFc2NhcGUnKVxuICAgICAgICB9XG4gICAgICAgIGF3YWl0IHRoaXMub3Blbk1lbnUodGhpcylcbiAgICAgICAgYXdhaXQgc2xlZXAoNTAwKVxuXG4gICAgICAgIGNvbnN0IG1lbnUgPSBuZXcgQ29udGV4dE1lbnUodGhpcy5sb2NhdG9yTWFwLCB0aGlzLmVsZW0pXG4gICAgICAgIGF3YWl0IG1lbnUud2FpdCgpXG4gICAgICAgIHJldHVybiBtZW51XG4gICAgfVxufVxuIl19