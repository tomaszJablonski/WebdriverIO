var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import clipboard from 'clipboardy';
import { Key } from 'webdriverio';
import { Workbench, BottomBarPanel, ContentAssist } from '../../index.js';
import { TextView, ChannelView } from './AbstractViews.js';
import { ElementWithContextMenu, PageDecorator, sleep } from '../utils.js';
import { OutputView as OutputViewLocators, DebugConsoleView as DebugConsoleViewLocators, TerminalView as TerminalViewLocators } from '../../locators/1.73.0.js';
/**
 * Output view of the bottom panel
 *
 * ```ts
 * const bottomBar = workbench.getBottomBar()
 * const outputView = await bottomBar.openOutputView()
 * console.log(await outputView.getChannelNames())
 * // returns
 * // [
 * //   'Tasks',
 * //   'Extensions',
 * //   'Microsoft Authentication',
 * //   'Git',
 * //   'GitHub Authentication',
 * //   'Log (Window)',
 * //   'Log (Main)',
 * //   'Log (Extension Host)',
 * //   'Log (Settings Sync)',
 * //   'Log (Shared)'
 * // ]
 * ```
 *
 * @category BottomBar
 */
let OutputView = class OutputView extends TextView {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'OutputView';
        this.actionsLabel = locators.OutputView.actionsLabel;
        this.setParentElement(panel.elem);
    }
};
OutputView = __decorate([
    PageDecorator(OutputViewLocators)
], OutputView);
export { OutputView };
/**
 * Debug Console view on the bottom panel
 * Most functionality will only be available when a debug session is running
 *
 * @category BottomBar
 */
let DebugConsoleView = class DebugConsoleView extends ElementWithContextMenu {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'DebugConsoleView';
        this.setParentElement(panel.elem);
    }
    /**
     * Get all text from the debug console
     */
    async getText() {
        const menu = await this.openContextMenu();
        await menu.select('Copy All');
        const text = await clipboard.read();
        await clipboard.write('');
        return text;
    }
    /**
     * Clear the console of all text
     */
    async clearText() {
        const menu = await this.openContextMenu();
        await menu.select('Clear Console');
    }
    /**
     * Type an expression into the debug console text area
     * @param expression expression in form of a string
     */
    async setExpression(expression) {
        const textarea = await this.elem.$(this.locatorMap.BottomBarViews.textArea);
        await textarea.setValue(expression);
    }
    /**
     * Evaluate an expression:
     *  - if no argument is supplied, evaluate the current expression present in debug console text area
     *  - if a string argument is supplied, replace the current expression with the `expression` argument and evaluate
     *
     * @param expression expression to evaluate. To use existing contents of the debug console
     *                   text area instead, don't define this argument
     */
    async evaluateExpression(expression) {
        if (expression) {
            await this.setExpression(expression);
        }
        await browser.keys('Enter');
    }
    /**
     * Create a content assist page object
     * @returns promise resolving to ContentAssist object
     */
    async getContentAssist() {
        return new ContentAssist(this.locatorMap, this).wait();
    }
};
DebugConsoleView = __decorate([
    PageDecorator(DebugConsoleViewLocators)
], DebugConsoleView);
export { DebugConsoleView };
/**
 * Terminal view on the bottom panel
 *
 * @category BottomBar
 */
let TerminalView = class TerminalView extends ChannelView {
    constructor(locators, panel = new BottomBarPanel(locators)) {
        super(locators);
        this.panel = panel;
        /**
         * @private
         */
        this.locatorKey = 'TerminalView';
        this.actionsLabel = locators.OutputView.actionsLabel;
    }
    /**
     * Execute command in the internal terminal and wait for results
     * @param command text of the command
     * @param timeout optional maximum time to wait for completion in milliseconds, 0 for unlimited
     * @returns Promise resolving when the command is finished
     */
    async executeCommand(command, timeout = 0) {
        const input = await this.textArea$;
        try {
            await input.clearValue();
        }
        catch (err) {
            // try clearing, ignore if not available
        }
        await input.setValue(command);
        await browser.action('key').down(Key.Enter).up(Key.Enter).perform();
        let timer = 0;
        let style = await input.getCSSProperty('left');
        do {
            if (timeout > 0 && timer > timeout) {
                throw new Error(`Timeout of ${timeout}ms exceeded`);
            }
            await sleep(500);
            timer += 500;
            style = await input.getCSSProperty('left');
        } while (style.value === '0px');
    }
    /**
     * Get all text from the internal terminal
     * Beware, no formatting.
     * @returns Promise resolving to all terminal text
     */
    async getText(retry = 3) {
        const workbench = new Workbench(this.locatorMap);
        await workbench.executeCommand('terminal select all');
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(500);
        await browser.executeWorkbench((vscode) => {
            // eslint-disable-next-line @typescript-eslint/no-unsafe-call
            vscode.commands.executeCommand('workbench.action.terminal.copySelection');
        });
        // eslint-disable-next-line wdio/no-pause
        await browser.pause(500);
        const text = await clipboard.read();
        if (!text && retry > 0) {
            return this.getText(retry - 1);
        }
        clipboard.writeSync('');
        return text.trim();
    }
    /**
     * Destroy the currently open terminal
     * @returns Promise resolving when Kill Terminal button is pressed
     */
    async killTerminal() {
        await new Workbench(this.locatorMap)
            .executeCommand('terminal: kill the active terminal instance');
    }
    /**
     * Initiate new terminal creation
     * @returns Promise resolving when New Terminal button is pressed
     */
    async newTerminal() {
        await new Workbench(this.locatorMap)
            .executeCommand(this.locators.newCommand);
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length < 1) {
            await browser.waitUntil(async () => {
                const list = await this.tabList$$;
                return list.length > 0;
            }, { timeout: 5000 });
        }
    }
    async getCurrentChannel() {
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length > 0) {
            return super.getCurrentChannel();
        }
        const singleTerm = await this.panel.elem.$$(this.locators.singleTab);
        if (singleTerm.length > 0) {
            return singleTerm[0].getText();
        }
        const list = await this.tabList$;
        const row = await list.$(this.locators.selectedRow);
        const label = (await row.getAttribute('aria-label')).split(' ');
        return `${label[1]}: ${label[2]}`;
    }
    async selectChannel(name) {
        const combo = await this.panel.elem.$$(this.locatorMap.BottomBarViews.channelCombo);
        if (combo.length > 0) {
            return super.selectChannel(name);
        }
        const singleTerm = await this.panel.elem.$$(this.locators.singleTab);
        if (singleTerm.length > 0) {
            return undefined;
        }
        const matches = name.match(/.*(\d+).?\s.*/);
        if (matches === null || !matches[1]) {
            throw new Error(`Channel ${name} not found`);
        }
        const channelNumber = matches[1];
        const list = await this.tabList$;
        const rows = await list.$$(this.locators.row);
        for (const row of rows) {
            const label = await row.getAttribute('aria-label');
            if (label.includes(channelNumber)) {
                await row.click();
                return undefined;
            }
        }
        throw new Error(`Channel ${name} not found`);
    }
};
TerminalView = __decorate([
    PageDecorator(TerminalViewLocators)
], TerminalView);
export { TerminalView };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvYm90dG9tQmFyL1ZpZXdzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLE9BQU8sU0FBUyxNQUFNLFlBQVksQ0FBQTtBQUNsQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sYUFBYSxDQUFBO0FBRWpDLE9BQU8sRUFBRSxTQUFTLEVBQUUsY0FBYyxFQUFFLGFBQWEsRUFBRSxNQUFNLGdCQUFnQixDQUFBO0FBQ3pFLE9BQU8sRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sb0JBQW9CLENBQUE7QUFDMUQsT0FBTyxFQUNILHNCQUFzQixFQUFFLGFBQWEsRUFDckMsS0FBSyxFQUNSLE1BQU0sYUFBYSxDQUFBO0FBQ3BCLE9BQU8sRUFDSCxVQUFVLElBQUksa0JBQWtCLEVBQ2hDLGdCQUFnQixJQUFJLHdCQUF3QixFQUM1QyxZQUFZLElBQUksb0JBQW9CLEVBQ3ZDLE1BQU0sMEJBQTBCLENBQUE7QUFHakM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBdUJHO0FBRUksSUFBTSxVQUFVLEdBQWhCLE1BQU0sVUFBVyxTQUFRLFFBQW1DO0lBTS9ELFlBQ0ksUUFBMEIsRUFDbkIsUUFBUSxJQUFJLGNBQWMsQ0FBQyxRQUFRLENBQUM7UUFFM0MsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRlIsVUFBSyxHQUFMLEtBQUssQ0FBK0I7UUFQL0M7O1dBRUc7UUFDSSxlQUFVLEdBQUcsWUFBcUIsQ0FBQTtRQU9yQyxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsWUFBc0IsQ0FBQTtRQUM5RCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3JDLENBQUM7Q0FDSixDQUFBO0FBZFksVUFBVTtJQUR0QixhQUFhLENBQUMsa0JBQWtCLENBQUM7R0FDckIsVUFBVSxDQWN0Qjs7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LENBQUE7SUFDaEQsQ0FBQztDQUNKLENBQUE7QUExSVksWUFBWTtJQUR4QixhQUFhLENBQUMsb0JBQW9CLENBQUM7R0FDdkIsWUFBWSxDQTBJeEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2xpcGJvYXJkIGZyb20gJ2NsaXBib2FyZHknXG5pbXBvcnQgeyBLZXkgfSBmcm9tICd3ZWJkcml2ZXJpbydcblxuaW1wb3J0IHsgV29ya2JlbmNoLCBCb3R0b21CYXJQYW5lbCwgQ29udGVudEFzc2lzdCB9IGZyb20gJy4uLy4uL2luZGV4LmpzJ1xuaW1wb3J0IHsgVGV4dFZpZXcsIENoYW5uZWxWaWV3IH0gZnJvbSAnLi9BYnN0cmFjdFZpZXdzLmpzJ1xuaW1wb3J0IHtcbiAgICBFbGVtZW50V2l0aENvbnRleHRNZW51LCBQYWdlRGVjb3JhdG9yLCBJUGFnZURlY29yYXRvciwgVlNDb2RlTG9jYXRvck1hcCxcbiAgICBzbGVlcFxufSBmcm9tICcuLi91dGlscy5qcydcbmltcG9ydCB7XG4gICAgT3V0cHV0VmlldyBhcyBPdXRwdXRWaWV3TG9jYXRvcnMsXG4gICAgRGVidWdDb25zb2xlVmlldyBhcyBEZWJ1Z0NvbnNvbGVWaWV3TG9jYXRvcnMsXG4gICAgVGVybWluYWxWaWV3IGFzIFRlcm1pbmFsVmlld0xvY2F0b3JzXG59IGZyb20gJy4uLy4uL2xvY2F0b3JzLzEuNzMuMC5qcydcblxuZXhwb3J0IGludGVyZmFjZSBPdXRwdXRWaWV3IGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIE91dHB1dFZpZXdMb2NhdG9ycz4ge31cbi8qKlxuICogT3V0cHV0IHZpZXcgb2YgdGhlIGJvdHRvbSBwYW5lbFxuICpcbiAqIGBgYHRzXG4gKiBjb25zdCBib3R0b21CYXIgPSB3b3JrYmVuY2guZ2V0Qm90dG9tQmFyKClcbiAqIGNvbnN0IG91dHB1dFZpZXcgPSBhd2FpdCBib3R0b21CYXIub3Blbk91dHB1dFZpZXcoKVxuICogY29uc29sZS5sb2coYXdhaXQgb3V0cHV0Vmlldy5nZXRDaGFubmVsTmFtZXMoKSlcbiAqIC8vIHJldHVybnNcbiAqIC8vIFtcbiAqIC8vICAgJ1Rhc2tzJyxcbiAqIC8vICAgJ0V4dGVuc2lvbnMnLFxuICogLy8gICAnTWljcm9zb2Z0IEF1dGhlbnRpY2F0aW9uJyxcbiAqIC8vICAgJ0dpdCcsXG4gKiAvLyAgICdHaXRIdWIgQXV0aGVudGljYXRpb24nLFxuICogLy8gICAnTG9nIChXaW5kb3cpJyxcbiAqIC8vICAgJ0xvZyAoTWFpbiknLFxuICogLy8gICAnTG9nIChFeHRlbnNpb24gSG9zdCknLFxuICogLy8gICAnTG9nIChTZXR0aW5ncyBTeW5jKScsXG4gKiAvLyAgICdMb2cgKFNoYXJlZCknXG4gKiAvLyBdXG4gKiBgYGBcbiAqXG4gKiBAY2F0ZWdvcnkgQm90dG9tQmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKE91dHB1dFZpZXdMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBPdXRwdXRWaWV3IGV4dGVuZHMgVGV4dFZpZXc8dHlwZW9mIE91dHB1dFZpZXdMb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnT3V0cHV0VmlldycgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIHB1YmxpYyBwYW5lbCA9IG5ldyBCb3R0b21CYXJQYW5lbChsb2NhdG9ycylcbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMpXG4gICAgICAgIHRoaXMuYWN0aW9uc0xhYmVsID0gbG9jYXRvcnMuT3V0cHV0Vmlldy5hY3Rpb25zTGFiZWwgYXMgc3RyaW5nXG4gICAgICAgIHRoaXMuc2V0UGFyZW50RWxlbWVudChwYW5lbC5lbGVtKVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBEZWJ1Z0NvbnNvbGVWaWV3IGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8dHlwZW9mIERlYnVnQ29uc29sZVZpZXdMb2NhdG9ycz4ge31cbi8qKlxuICogRGVidWcgQ29uc29sZSB2aWV3IG9uIHRoZSBib3R0b20gcGFuZWxcbiAqIE1vc3QgZnVuY3Rpb25hbGl0eSB3aWxsIG9ubHkgYmUgYXZhaWxhYmxlIHdoZW4gYSBkZWJ1ZyBzZXNzaW9uIGlzIHJ1bm5pbmdcbiAqXG4gKiBAY2F0ZWdvcnkgQm90dG9tQmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKERlYnVnQ29uc29sZVZpZXdMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBEZWJ1Z0NvbnNvbGVWaWV3IGV4dGVuZHMgRWxlbWVudFdpdGhDb250ZXh0TWVudTx0eXBlb2YgRGVidWdDb25zb2xlVmlld0xvY2F0b3JzPiB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBwdWJsaWMgbG9jYXRvcktleSA9ICdEZWJ1Z0NvbnNvbGVWaWV3JyBhcyBjb25zdFxuXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBsb2NhdG9yczogVlNDb2RlTG9jYXRvck1hcCxcbiAgICAgICAgcHVibGljIHBhbmVsOiBCb3R0b21CYXJQYW5lbCA9IG5ldyBCb3R0b21CYXJQYW5lbChsb2NhdG9ycylcbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMpXG4gICAgICAgIHRoaXMuc2V0UGFyZW50RWxlbWVudChwYW5lbC5lbGVtKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEdldCBhbGwgdGV4dCBmcm9tIHRoZSBkZWJ1ZyBjb25zb2xlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGV4dCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgbWVudSA9IGF3YWl0IHRoaXMub3BlbkNvbnRleHRNZW51KClcbiAgICAgICAgYXdhaXQgbWVudS5zZWxlY3QoJ0NvcHkgQWxsJylcbiAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IGNsaXBib2FyZC5yZWFkKClcbiAgICAgICAgYXdhaXQgY2xpcGJvYXJkLndyaXRlKCcnKVxuICAgICAgICByZXR1cm4gdGV4dFxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENsZWFyIHRoZSBjb25zb2xlIG9mIGFsbCB0ZXh0XG4gICAgICovXG4gICAgYXN5bmMgY2xlYXJUZXh0ICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgbWVudSA9IGF3YWl0IHRoaXMub3BlbkNvbnRleHRNZW51KClcbiAgICAgICAgYXdhaXQgbWVudS5zZWxlY3QoJ0NsZWFyIENvbnNvbGUnKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFR5cGUgYW4gZXhwcmVzc2lvbiBpbnRvIHRoZSBkZWJ1ZyBjb25zb2xlIHRleHQgYXJlYVxuICAgICAqIEBwYXJhbSBleHByZXNzaW9uIGV4cHJlc3Npb24gaW4gZm9ybSBvZiBhIHN0cmluZ1xuICAgICAqL1xuICAgIGFzeW5jIHNldEV4cHJlc3Npb24gKGV4cHJlc3Npb246IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCB0ZXh0YXJlYSA9IGF3YWl0IHRoaXMuZWxlbS4kKHRoaXMubG9jYXRvck1hcC5Cb3R0b21CYXJWaWV3cy50ZXh0QXJlYSBhcyBzdHJpbmcpXG4gICAgICAgIGF3YWl0IHRleHRhcmVhLnNldFZhbHVlKGV4cHJlc3Npb24pXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXZhbHVhdGUgYW4gZXhwcmVzc2lvbjpcbiAgICAgKiAgLSBpZiBubyBhcmd1bWVudCBpcyBzdXBwbGllZCwgZXZhbHVhdGUgdGhlIGN1cnJlbnQgZXhwcmVzc2lvbiBwcmVzZW50IGluIGRlYnVnIGNvbnNvbGUgdGV4dCBhcmVhXG4gICAgICogIC0gaWYgYSBzdHJpbmcgYXJndW1lbnQgaXMgc3VwcGxpZWQsIHJlcGxhY2UgdGhlIGN1cnJlbnQgZXhwcmVzc2lvbiB3aXRoIHRoZSBgZXhwcmVzc2lvbmAgYXJndW1lbnQgYW5kIGV2YWx1YXRlXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXhwcmVzc2lvbiBleHByZXNzaW9uIHRvIGV2YWx1YXRlLiBUbyB1c2UgZXhpc3RpbmcgY29udGVudHMgb2YgdGhlIGRlYnVnIGNvbnNvbGVcbiAgICAgKiAgICAgICAgICAgICAgICAgICB0ZXh0IGFyZWEgaW5zdGVhZCwgZG9uJ3QgZGVmaW5lIHRoaXMgYXJndW1lbnRcbiAgICAgKi9cbiAgICBhc3luYyBldmFsdWF0ZUV4cHJlc3Npb24gKGV4cHJlc3Npb24/OiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2V0RXhwcmVzc2lvbihleHByZXNzaW9uKVxuICAgICAgICB9XG4gICAgICAgIGF3YWl0IGJyb3dzZXIua2V5cygnRW50ZXInKVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIGNvbnRlbnQgYXNzaXN0IHBhZ2Ugb2JqZWN0XG4gICAgICogQHJldHVybnMgcHJvbWlzZSByZXNvbHZpbmcgdG8gQ29udGVudEFzc2lzdCBvYmplY3RcbiAgICAgKi9cbiAgICBhc3luYyBnZXRDb250ZW50QXNzaXN0ICgpOiBQcm9taXNlPENvbnRlbnRBc3Npc3Q+IHtcbiAgICAgICAgcmV0dXJuIG5ldyBDb250ZW50QXNzaXN0KHRoaXMubG9jYXRvck1hcCwgdGhpcykud2FpdCgpXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRlcm1pbmFsVmlldyBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBUZXJtaW5hbFZpZXdMb2NhdG9ycz4ge31cbi8qKlxuICogVGVybWluYWwgdmlldyBvbiB0aGUgYm90dG9tIHBhbmVsXG4gKlxuICogQGNhdGVnb3J5IEJvdHRvbUJhclxuICovXG5AUGFnZURlY29yYXRvcihUZXJtaW5hbFZpZXdMb2NhdG9ycylcbmV4cG9ydCBjbGFzcyBUZXJtaW5hbFZpZXcgZXh0ZW5kcyBDaGFubmVsVmlldzx0eXBlb2YgVGVybWluYWxWaWV3TG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1Rlcm1pbmFsVmlldycgYXMgY29uc3RcblxuICAgIGNvbnN0cnVjdG9yIChcbiAgICAgICAgbG9jYXRvcnM6IFZTQ29kZUxvY2F0b3JNYXAsXG4gICAgICAgIHB1YmxpYyBwYW5lbCA9IG5ldyBCb3R0b21CYXJQYW5lbChsb2NhdG9ycylcbiAgICApIHtcbiAgICAgICAgc3VwZXIobG9jYXRvcnMpXG4gICAgICAgIHRoaXMuYWN0aW9uc0xhYmVsID0gbG9jYXRvcnMuT3V0cHV0Vmlldy5hY3Rpb25zTGFiZWwgYXMgc3RyaW5nXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXhlY3V0ZSBjb21tYW5kIGluIHRoZSBpbnRlcm5hbCB0ZXJtaW5hbCBhbmQgd2FpdCBmb3IgcmVzdWx0c1xuICAgICAqIEBwYXJhbSBjb21tYW5kIHRleHQgb2YgdGhlIGNvbW1hbmRcbiAgICAgKiBAcGFyYW0gdGltZW91dCBvcHRpb25hbCBtYXhpbXVtIHRpbWUgdG8gd2FpdCBmb3IgY29tcGxldGlvbiBpbiBtaWxsaXNlY29uZHMsIDAgZm9yIHVubGltaXRlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIGNvbW1hbmQgaXMgZmluaXNoZWRcbiAgICAgKi9cbiAgICBhc3luYyBleGVjdXRlQ29tbWFuZCAoY29tbWFuZDogc3RyaW5nLCB0aW1lb3V0ID0gMCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBjb25zdCBpbnB1dCA9IGF3YWl0IHRoaXMudGV4dEFyZWEkXG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGlucHV0LmNsZWFyVmFsdWUoKVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICAgIC8vIHRyeSBjbGVhcmluZywgaWdub3JlIGlmIG5vdCBhdmFpbGFibGVcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBpbnB1dC5zZXRWYWx1ZShjb21tYW5kKVxuICAgICAgICBhd2FpdCBicm93c2VyLmFjdGlvbigna2V5JykuZG93bihLZXkuRW50ZXIpLnVwKEtleS5FbnRlcikucGVyZm9ybSgpXG5cbiAgICAgICAgbGV0IHRpbWVyID0gMFxuICAgICAgICBsZXQgc3R5bGUgPSBhd2FpdCBpbnB1dC5nZXRDU1NQcm9wZXJ0eSgnbGVmdCcpXG4gICAgICAgIGRvIHtcbiAgICAgICAgICAgIGlmICh0aW1lb3V0ID4gMCAmJiB0aW1lciA+IHRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRpbWVvdXQgb2YgJHt0aW1lb3V0fW1zIGV4Y2VlZGVkYClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHNsZWVwKDUwMClcbiAgICAgICAgICAgIHRpbWVyICs9IDUwMFxuICAgICAgICAgICAgc3R5bGUgPSBhd2FpdCBpbnB1dC5nZXRDU1NQcm9wZXJ0eSgnbGVmdCcpXG4gICAgICAgIH0gd2hpbGUgKHN0eWxlLnZhbHVlID09PSAnMHB4JylcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgYWxsIHRleHQgZnJvbSB0aGUgaW50ZXJuYWwgdGVybWluYWxcbiAgICAgKiBCZXdhcmUsIG5vIGZvcm1hdHRpbmcuXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYWxsIHRlcm1pbmFsIHRleHRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRUZXh0IChyZXRyeSA9IDMpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgICAgICBjb25zdCB3b3JrYmVuY2ggPSBuZXcgV29ya2JlbmNoKHRoaXMubG9jYXRvck1hcClcbiAgICAgICAgYXdhaXQgd29ya2JlbmNoLmV4ZWN1dGVDb21tYW5kKCd0ZXJtaW5hbCBzZWxlY3QgYWxsJylcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHdkaW8vbm8tcGF1c2VcbiAgICAgICAgYXdhaXQgYnJvd3Nlci5wYXVzZSg1MDApXG4gICAgICAgIGF3YWl0IGJyb3dzZXIuZXhlY3V0ZVdvcmtiZW5jaCgodnNjb2RlKSA9PiB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVuc2FmZS1jYWxsXG4gICAgICAgICAgICB2c2NvZGUuY29tbWFuZHMuZXhlY3V0ZUNvbW1hbmQoJ3dvcmtiZW5jaC5hY3Rpb24udGVybWluYWwuY29weVNlbGVjdGlvbicpXG4gICAgICAgIH0pXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSB3ZGlvL25vLXBhdXNlXG4gICAgICAgIGF3YWl0IGJyb3dzZXIucGF1c2UoNTAwKVxuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgY2xpcGJvYXJkLnJlYWQoKVxuXG4gICAgICAgIGlmICghdGV4dCAmJiByZXRyeSA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFRleHQocmV0cnkgLSAxKVxuICAgICAgICB9XG5cbiAgICAgICAgY2xpcGJvYXJkLndyaXRlU3luYygnJylcbiAgICAgICAgcmV0dXJuIHRleHQudHJpbSgpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVzdHJveSB0aGUgY3VycmVudGx5IG9wZW4gdGVybWluYWxcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB3aGVuIEtpbGwgVGVybWluYWwgYnV0dG9uIGlzIHByZXNzZWRcbiAgICAgKi9cbiAgICBhc3luYyBraWxsVGVybWluYWwgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBhd2FpdCBuZXcgV29ya2JlbmNoKHRoaXMubG9jYXRvck1hcClcbiAgICAgICAgICAgIC5leGVjdXRlQ29tbWFuZCgndGVybWluYWw6IGtpbGwgdGhlIGFjdGl2ZSB0ZXJtaW5hbCBpbnN0YW5jZScpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogSW5pdGlhdGUgbmV3IHRlcm1pbmFsIGNyZWF0aW9uXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiBOZXcgVGVybWluYWwgYnV0dG9uIGlzIHByZXNzZWRcbiAgICAgKi9cbiAgICBhc3luYyBuZXdUZXJtaW5hbCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IG5ldyBXb3JrYmVuY2godGhpcy5sb2NhdG9yTWFwKVxuICAgICAgICAgICAgLmV4ZWN1dGVDb21tYW5kKHRoaXMubG9jYXRvcnMubmV3Q29tbWFuZClcbiAgICAgICAgY29uc3QgY29tYm8gPSBhd2FpdCB0aGlzLnBhbmVsLmVsZW0uJCQodGhpcy5sb2NhdG9yTWFwLkJvdHRvbUJhclZpZXdzLmNoYW5uZWxDb21ibyBhcyBzdHJpbmcpXG4gICAgICAgIGlmIChjb21iby5sZW5ndGggPCAxKSB7XG4gICAgICAgICAgICBhd2FpdCBicm93c2VyLndhaXRVbnRpbChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbGlzdCA9IGF3YWl0IHRoaXMudGFiTGlzdCQkXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxpc3QubGVuZ3RoID4gMFxuICAgICAgICAgICAgfSwgeyB0aW1lb3V0OiA1MDAwIH0pXG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBhc3luYyBnZXRDdXJyZW50Q2hhbm5lbCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgY29uc3QgY29tYm8gPSBhd2FpdCB0aGlzLnBhbmVsLmVsZW0uJCQodGhpcy5sb2NhdG9yTWFwLkJvdHRvbUJhclZpZXdzLmNoYW5uZWxDb21ibyBhcyBzdHJpbmcpXG4gICAgICAgIGlmIChjb21iby5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VwZXIuZ2V0Q3VycmVudENoYW5uZWwoKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNpbmdsZVRlcm0gPSBhd2FpdCB0aGlzLnBhbmVsLmVsZW0uJCQodGhpcy5sb2NhdG9ycy5zaW5nbGVUYWIpXG4gICAgICAgIGlmIChzaW5nbGVUZXJtLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiBzaW5nbGVUZXJtWzBdLmdldFRleHQoKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxpc3QgPSBhd2FpdCB0aGlzLnRhYkxpc3QkXG4gICAgICAgIGNvbnN0IHJvdyA9IGF3YWl0IGxpc3QuJCh0aGlzLmxvY2F0b3JzLnNlbGVjdGVkUm93KVxuICAgICAgICBjb25zdCBsYWJlbCA9IChhd2FpdCByb3cuZ2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJykpLnNwbGl0KCcgJylcblxuICAgICAgICByZXR1cm4gYCR7bGFiZWxbMV19OiAke2xhYmVsWzJdfWBcbiAgICB9XG5cbiAgICBhc3luYyBzZWxlY3RDaGFubmVsIChuYW1lOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgY29uc3QgY29tYm8gPSBhd2FpdCB0aGlzLnBhbmVsLmVsZW0uJCQodGhpcy5sb2NhdG9yTWFwLkJvdHRvbUJhclZpZXdzLmNoYW5uZWxDb21ibyBhcyBzdHJpbmcpXG4gICAgICAgIGlmIChjb21iby5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gc3VwZXIuc2VsZWN0Q2hhbm5lbChuYW1lKVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNpbmdsZVRlcm0gPSBhd2FpdCB0aGlzLnBhbmVsLmVsZW0uJCQodGhpcy5sb2NhdG9ycy5zaW5nbGVUYWIpXG4gICAgICAgIGlmIChzaW5nbGVUZXJtLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSBuYW1lLm1hdGNoKC8uKihcXGQrKS4/XFxzLiovKVxuICAgICAgICBpZiAobWF0Y2hlcyA9PT0gbnVsbCB8fCAhbWF0Y2hlc1sxXSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDaGFubmVsICR7bmFtZX0gbm90IGZvdW5kYClcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGFubmVsTnVtYmVyID0gbWF0Y2hlc1sxXVxuXG4gICAgICAgIGNvbnN0IGxpc3QgPSBhd2FpdCB0aGlzLnRhYkxpc3QkXG4gICAgICAgIGNvbnN0IHJvd3MgPSBhd2FpdCBsaXN0LiQkKHRoaXMubG9jYXRvcnMucm93KVxuXG4gICAgICAgIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gYXdhaXQgcm93LmdldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpXG4gICAgICAgICAgICBpZiAobGFiZWwuaW5jbHVkZXMoY2hhbm5lbE51bWJlcikpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCByb3cuY2xpY2soKVxuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENoYW5uZWwgJHtuYW1lfSBub3QgZm91bmRgKVxuICAgIH1cbn1cbiJdfQ==