var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { ContextMenu, WelcomeContentSection } from '../index.js';
import { PageDecorator, BasePage, ElementWithContextMenu } from '../utils.js';
import { ViewSection as ViewSectionLocators } from '../../locators/1.73.0.js';
/**
 * Page object representing a collapsible content section of the side bar view
 *
 * @category Sidebar
 */
export class ViewSection extends BasePage {
    constructor(locators, panel, content) {
        super(locators, panel);
        this.content = content;
    }
    /**
     * Get the title of the section as string
     * @returns Promise resolving to section title
     */
    async getTitle() {
        return this.title$.getAttribute(this.locators.titleText);
    }
    /**
     * Expand the section if collapsed
     * @returns Promise resolving when the section is expanded
     */
    async expand() {
        if (await this.isHeaderHidden()) {
            return;
        }
        if (!await this.isExpanded()) {
            const panel = await this.header$;
            await panel.click();
            await browser.waitUntil(async () => (await panel.getAttribute(this.locators.headerExpanded) === 'true'), { timeout: 1000 });
        }
    }
    /**
     * Collapse the section if expanded
     * @returns Promise resolving when the section is collapsed
     */
    async collapse() {
        if (await this.isHeaderHidden()) {
            return;
        }
        if (await this.isExpanded()) {
            const panel = await this.header$;
            await panel.click();
            await browser.waitUntil(async () => (await panel.getAttribute(this.locators.headerExpanded) === 'false'), { timeout: 1000 });
        }
    }
    /**
     * Finds whether the section is expanded
     * @returns Promise resolving to true/false
     */
    async isExpanded() {
        const expanded = await this.header$.getAttribute(this.locators.headerExpanded);
        return expanded === 'true';
    }
    /**
     * Finds [Welcome Content](https://code.visualstudio.com/api/extension-guides/tree-view#welcome-content)
     * present in this ViewSection and returns it. If none is found, then `undefined` is returned
     *
     */
    async findWelcomeContent() {
        try {
            const res = await this.welcomeContent$;
            if (!await res.isDisplayed()) {
                return undefined;
            }
            // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
            return new WelcomeContentSection(this.locatorMap, res, this);
        }
        catch (_err) {
            return undefined;
        }
    }
    /**
     * Retrieve the action buttons on the section's header
     * @returns Promise resolving to array of ViewPanelAction objects
     */
    async getActions() {
        const actions = [];
        if (!await this.isHeaderHidden()) {
            const elements = await this
                .header$
                .$(this.locators.actions)
                .$$(this.locators.button);
            for (const element of elements) {
                actions.push(await new ViewPanelAction(this.locatorMap, 
                // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
                element, this).wait());
            }
        }
        return actions;
    }
    /**
     * Retrieve an action button on the sections's header by its label
     * @param label label/title of the button
     * @returns ViewPanelAction object if found, undefined otherwise
     */
    async getAction(label) {
        const actions = await this.getActions();
        for (const action of actions) {
            if (await action.getLabel() === label) {
                return action;
            }
        }
        return undefined;
    }
    /**
     * Click on the More Actions... item if it exists
     *
     * @returns ContextMenu page object if the action succeeds, undefined otherwise
     */
    async moreActions() {
        const more = await this.getAction('More Actions...');
        if (!more) {
            return undefined;
        }
        const section = this;
        const self = this;
        const btn = new class extends ElementWithContextMenu {
            constructor() {
                super(...arguments);
                this.locatorKey = 'ViewSection';
            }
            async openContextMenu() {
                await this.elem.click();
                const shadowRootHost = await section.elem.$$('.shadow-root-host');
                if (shadowRootHost.length > 0) {
                    const shadowRoot = $(await browser.execute('return arguments[0].shadowRoot', shadowRootHost[0]));
                    return new ContextMenu(self.locatorMap, shadowRoot).wait();
                }
                return super.openContextMenu();
            }
        }(this.locatorMap, more.elem, this.elem);
        return btn.openContextMenu();
    }
    async isHeaderHidden() {
        return (await this.header$.getAttribute('class')).indexOf('hidden') > -1;
    }
}
/**
 * Action button on the header of a view section
 *
 * @category Sidebar
 */
let ViewPanelAction = class ViewPanelAction extends BasePage {
    constructor(locators, element, viewPart) {
        super(locators, element, viewPart.elem);
        /**
         * @private
         */
        this.locatorKey = 'ViewSection';
    }
    /**
     * Get label of the action button
     */
    async getLabel() {
        return this.elem.getAttribute(this.locators.buttonLabel);
    }
    async wait(timeout = 1000) {
        await this.elem.waitForEnabled({ timeout });
        return this;
    }
};
ViewPanelAction = __decorate([
    PageDecorator(ViewSectionLocators)
], ViewPanelAction);
export { ViewPanelAction };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld1NlY3Rpb24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvc2lkZWJhci9WaWV3U2VjdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFFQSxPQUFPLEVBQ0gsV0FBVyxFQUF5QixxQkFBcUIsRUFDNUQsTUFBTSxhQUFhLENBQUE7QUFDcEIsT0FBTyxFQUNILGFBQWEsRUFBa0IsUUFBUSxFQUFFLHNCQUFzQixFQUNsRSxNQUFNLGFBQWEsQ0FBQTtBQUNwQixPQUFPLEVBQ0gsV0FBVyxJQUFJLG1CQUFtQixFQUlyQyxNQUFNLDBCQUEwQixDQUFBO0FBYWpDOzs7O0dBSUc7QUFDSCxNQUFNLE9BQWdCLFdBQVksU0FBUSxRQUFnQztJQUN0RSxZQUNJLFFBQTBCLEVBQzFCLEtBQW1ELEVBQzVDLE9BQW9CO1FBRTNCLEtBQUssQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUE7UUFGZixZQUFPLEdBQVAsT0FBTyxDQUFhO0lBRy9CLENBQUM7SUFFRDs7O09BR0c7SUFDSCxLQUFLLENBQUMsUUFBUTtRQUNWLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQTtJQUM1RCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLE1BQU07UUFDUixJQUFJLE1BQU0sSUFBSSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUM7WUFDOUIsT0FBTTtRQUNWLENBQUM7UUFDRCxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsVUFBVSxFQUFFLEVBQUUsQ0FBQztZQUMzQixNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUE7WUFDaEMsTUFBTSxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUE7WUFDbkIsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FDaEMsTUFBTSxLQUFLLENB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QVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQTtJQUM1RSxDQUFDO0NBQ0o7QUFHRDs7OztHQUlHO0FBRUksSUFBTSxlQUFlLEdBQXJCLE1BQU0sZUFBZ0IsU0FBUSxRQUFvQztJQU1yRSxZQUNJLFFBQTBCLEVBQzFCLE9BQXFELEVBQ3JELFFBQXFCO1FBRXJCLEtBQUssQ0FBQyxRQUFRLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQVYzQzs7V0FFRztRQUNJLGVBQVUsR0FBRyxhQUFzQixDQUFBO0lBUTFDLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQzVELENBQUM7SUFFRCxLQUFLLENBQUMsSUFBSSxDQUFFLE9BQU8sR0FBRyxJQUFJO1FBQ3RCLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQzNDLE9BQU8sSUFBSSxDQUFBO0lBQ2YsQ0FBQztDQUNKLENBQUE7QUF6QlksZUFBZTtJQUQzQixhQUFhLENBQUMsbUJBQW1CLENBQUM7R0FDdEIsZUFBZSxDQXlCM0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IENoYWluYWJsZVByb21pc2VFbGVtZW50IH0gZnJvbSAnd2ViZHJpdmVyaW8nXG5cbmltcG9ydCB7XG4gICAgQ29udGV4dE1lbnUsIFZpZXdDb250ZW50LCBWaWV3SXRlbSwgV2VsY29tZUNvbnRlbnRTZWN0aW9uXG59IGZyb20gJy4uL2luZGV4LmpzJ1xuaW1wb3J0IHtcbiAgICBQYWdlRGVjb3JhdG9yLCBJUGFnZURlY29yYXRvciwgQmFzZVBhZ2UsIEVsZW1lbnRXaXRoQ29udGV4dE1lbnUsIFZTQ29kZUxvY2F0b3JNYXBcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQge1xuICAgIFZpZXdTZWN0aW9uIGFzIFZpZXdTZWN0aW9uTG9jYXRvcnMsXG4gICAgRXh0ZW5zaW9uc1ZpZXdTZWN0aW9uIGFzIEV4dGVuc2lvbnNWaWV3U2VjdGlvbkxvY2F0b3JzLFxuICAgIEN1c3RvbVRyZWVTZWN0aW9uIGFzIEN1c3RvbVRyZWVTZWN0aW9uTG9jYXRvcnMsXG4gICAgRGVmYXVsdFRyZWVTZWN0aW9uIGFzIERlZmF1bHRUcmVlU2VjdGlvbkxvY2F0b3JzXG59IGZyb20gJy4uLy4uL2xvY2F0b3JzLzEuNzMuMC5qcydcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmV4cG9ydCB0eXBlIEFsbFZpZXdTZWN0aW9uTG9jYXRvcnMgPSAoXG4gICAgdHlwZW9mIFZpZXdTZWN0aW9uTG9jYXRvcnMgJlxuICAgIHR5cGVvZiBFeHRlbnNpb25zVmlld1NlY3Rpb25Mb2NhdG9ycyAmXG4gICAgdHlwZW9mIEN1c3RvbVRyZWVTZWN0aW9uTG9jYXRvcnMgJlxuICAgIHR5cGVvZiBEZWZhdWx0VHJlZVNlY3Rpb25Mb2NhdG9yc1xuKVxuXG5leHBvcnQgaW50ZXJmYWNlIFZpZXdTZWN0aW9uIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8QWxsVmlld1NlY3Rpb25Mb2NhdG9ycz4geyB9XG4vKipcbiAqIFBhZ2Ugb2JqZWN0IHJlcHJlc2VudGluZyBhIGNvbGxhcHNpYmxlIGNvbnRlbnQgc2VjdGlvbiBvZiB0aGUgc2lkZSBiYXIgdmlld1xuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWaWV3U2VjdGlvbiBleHRlbmRzIEJhc2VQYWdlPEFsbFZpZXdTZWN0aW9uTG9jYXRvcnM+IHtcbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBwYW5lbDogQ2hhaW5hYmxlUHJvbWlzZUVsZW1lbnQ8V2ViZHJpdmVySU8uRWxlbWVudD4sXG4gICAgICAgIHB1YmxpYyBjb250ZW50OiBWaWV3Q29udGVudFxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycywgcGFuZWwpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogR2V0IHRoZSB0aXRsZSBvZiB0aGUgc2VjdGlvbiBhcyBzdHJpbmdcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBzZWN0aW9uIHRpdGxlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0VGl0bGUgKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpdGxlJC5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9ycy50aXRsZVRleHQpXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRXhwYW5kIHRoZSBzZWN0aW9uIGlmIGNvbGxhcHNlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIHNlY3Rpb24gaXMgZXhwYW5kZWRcbiAgICAgKi9cbiAgICBhc3luYyBleHBhbmQgKCk6IFByb21pc2U8dm9pZD4ge1xuICAgICAgICBpZiAoYXdhaXQgdGhpcy5pc0hlYWRlckhpZGRlbigpKSB7XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWF3YWl0IHRoaXMuaXNFeHBhbmRlZCgpKSB7XG4gICAgICAgICAgICBjb25zdCBwYW5lbCA9IGF3YWl0IHRoaXMuaGVhZGVyJFxuICAgICAgICAgICAgYXdhaXQgcGFuZWwuY2xpY2soKVxuICAgICAgICAgICAgYXdhaXQgYnJvd3Nlci53YWl0VW50aWwoYXN5bmMgKCkgPT4gKFxuICAgICAgICAgICAgICAgIGF3YWl0IHBhbmVsLmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JzLmhlYWRlckV4cGFuZGVkKSA9PT0gJ3RydWUnXG4gICAgICAgICAgICApLCB7IHRpbWVvdXQ6IDEwMDAgfSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENvbGxhcHNlIHRoZSBzZWN0aW9uIGlmIGV4cGFuZGVkXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgd2hlbiB0aGUgc2VjdGlvbiBpcyBjb2xsYXBzZWRcbiAgICAgKi9cbiAgICBhc3luYyBjb2xsYXBzZSAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzSGVhZGVySGlkZGVuKCkpIHtcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICAgIGlmIChhd2FpdCB0aGlzLmlzRXhwYW5kZWQoKSkge1xuICAgICAgICAgICAgY29uc3QgcGFuZWwgPSBhd2FpdCB0aGlzLmhlYWRlciRcbiAgICAgICAgICAgIGF3YWl0IHBhbmVsLmNsaWNrKClcbiAgICAgICAgICAgIGF3YWl0IGJyb3dzZXIud2FpdFVudGlsKGFzeW5jICgpID0+IChcbiAgICAgICAgICAgICAgICBhd2FpdCBwYW5lbC5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9ycy5oZWFkZXJFeHBhbmRlZCkgPT09ICdmYWxzZSdcbiAgICAgICAgICAgICksIHsgdGltZW91dDogMTAwMCB9KVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZHMgd2hldGhlciB0aGUgc2VjdGlvbiBpcyBleHBhbmRlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUvZmFsc2VcbiAgICAgKi9cbiAgICBhc3luYyBpc0V4cGFuZGVkICgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAgICAgY29uc3QgZXhwYW5kZWQgPSBhd2FpdCB0aGlzLmhlYWRlciQuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuaGVhZGVyRXhwYW5kZWQpXG4gICAgICAgIHJldHVybiBleHBhbmRlZCA9PT0gJ3RydWUnXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZHMgW1dlbGNvbWUgQ29udGVudF0oaHR0cHM6Ly9jb2RlLnZpc3VhbHN0dWRpby5jb20vYXBpL2V4dGVuc2lvbi1ndWlkZXMvdHJlZS12aWV3I3dlbGNvbWUtY29udGVudClcbiAgICAgKiBwcmVzZW50IGluIHRoaXMgVmlld1NlY3Rpb24gYW5kIHJldHVybnMgaXQuIElmIG5vbmUgaXMgZm91bmQsIHRoZW4gYHVuZGVmaW5lZGAgaXMgcmV0dXJuZWRcbiAgICAgKlxuICAgICAqL1xuICAgIHB1YmxpYyBhc3luYyBmaW5kV2VsY29tZUNvbnRlbnQgKCk6IFByb21pc2U8V2VsY29tZUNvbnRlbnRTZWN0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLndlbGNvbWVDb250ZW50JFxuICAgICAgICAgICAgaWYgKCFhd2FpdCByZXMuaXNEaXNwbGF5ZWQoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5zYWZlLWFyZ3VtZW50XG4gICAgICAgICAgICByZXR1cm4gbmV3IFdlbGNvbWVDb250ZW50U2VjdGlvbih0aGlzLmxvY2F0b3JNYXAsIHJlcyBhcyBhbnksIHRoaXMpXG4gICAgICAgIH0gY2F0Y2ggKF9lcnIpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGFsbCBpdGVtcyBjdXJyZW50bHkgdmlzaWJsZSBpbiB0aGUgdmlldyBzZWN0aW9uLlxuICAgICAqIE5vdGUgdGhhdCBhbnkgaXRlbSBjdXJyZW50bHkgYmV5b25kIHRoZSB2aXNpYmxlIGxpc3QsIGkuZS4gbm90IHNjcm9sbGVkIHRvLCB3aWxsIG5vdCBiZSByZXRyaWV2ZWQuXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYXJyYXkgb2YgVmlld0l0ZW0gb2JqZWN0c1xuICAgICAqL1xuICAgIGFic3RyYWN0IGdldFZpc2libGVJdGVtcyAoKTogUHJvbWlzZTxWaWV3SXRlbVtdPlxuXG4gICAgLyoqXG4gICAgICogRmluZCBhbiBpdGVtIGluIHRoaXMgdmlldyBzZWN0aW9uIGJ5IGxhYmVsLiBEb2VzIG5vdCBwZXJmb3JtIHJlY3Vyc2l2ZSBzZWFyY2ggdGhyb3VnaCB0aGUgd2hvbGUgdHJlZS5cbiAgICAgKiBEb2VzIGhvd2V2ZXIgc2Nyb2xsIHRocm91Z2ggYWxsIHRoZSBleHBhbmRlZCBjb250ZW50LiBXaWxsIGZpbmQgaXRlbXMgYmV5b25kIHRoZSBjdXJyZW50IHNjcm9sbCByYW5nZS5cbiAgICAgKiBAcGFyYW0gbGFiZWwgTGFiZWwgb2YgdGhlIGl0ZW0gdG8gc2VhcmNoIGZvci5cbiAgICAgKiBAcGFyYW0gbWF4TGV2ZWwgTGltaXQgaG93IGRlZXAgdGhlIGFsZ29yaXRobSBzaG91bGQgbG9vayBpbnRvIGFueSBleHBhbmRlZCBpdGVtcywgZGVmYXVsdCB1bmxpbWl0ZWQgKDApXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gVmlld0l0ZW0gb2JqZWN0IGlzIHN1Y2ggaXRlbSBleGlzdHMsIHVuZGVmaW5lZCBvdGhlcndpc2VcbiAgICAgKi9cbiAgICBhYnN0cmFjdCBmaW5kSXRlbSAobGFiZWw6IHN0cmluZywgbWF4TGV2ZWw/OiBudW1iZXIpOiBQcm9taXNlPFZpZXdJdGVtIHwgdW5kZWZpbmVkPlxuXG4gICAgLyoqXG4gICAgICogT3BlbiBhbiBpdGVtIHdpdGggYSBnaXZlbiBwYXRoIHJlcHJlc2VudGVkIGJ5IGEgc2VxdWVuY2Ugb2YgbGFiZWxzXG4gICAgICpcbiAgICAgKiBlLmcgdG8gb3BlbiAnZmlsZScgaW5zaWRlICdmb2xkZXInLCBjYWxsXG4gICAgICogb3Blbkl0ZW0oJ2ZvbGRlcicsICdmaWxlJylcbiAgICAgKlxuICAgICAqIFRoZSBmaXJzdCBpdGVtIGlzIG9ubHkgc2VhcmNoZWQgZm9yIGRpcmVjdGx5IHdpdGhpbiB0aGUgcm9vdCBlbGVtZW50IChkZXB0aCAxKS5cbiAgICAgKiBUaGUgbGFiZWwgc2VxdWVuY2UgaXMgaGFuZGxlZCBpbiBvcmRlci4gSWYgYSBsZWFmIGl0ZW0gKGEgZmlsZSBmb3IgZXhhbXBsZSkgaXMgZm91bmQgaW4gdGhlIG1pZGRsZVxuICAgICAqIG9mIHRoZSBzZXF1ZW5jZSwgdGhlIHJlc3QgaXMgaWdub3JlZC5cbiAgICAgKlxuICAgICAqIElmIHRoZSBpdGVtIHN0cnVjdHVyZSBpcyBmbGF0LCB1c2UgdGhlIGl0ZW0ncyB0aXRsZSB0byBzZWFyY2ggYnkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCBTZXF1ZW5jZSBvZiBsYWJlbHMgdGhhdCBtYWtlIHVwIHRoZSBwYXRoIHRvIGEgZ2l2ZW4gaXRlbS5cbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBhcnJheSBvZiBWaWV3SXRlbSBvYmplY3RzIHJlcHJlc2VudGluZyB0aGUgbGFzdCBpdGVtJ3MgY2hpbGRyZW4uXG4gICAgICogSWYgdGhlIGxhc3QgaXRlbSBpcyBhIGxlYWYsIGVtcHR5IGFycmF5IGlzIHJldHVybmVkLlxuICAgICAqL1xuICAgIGFic3RyYWN0IG9wZW5JdGVtICguLi5wYXRoOiBzdHJpbmdbXSk6IFByb21pc2U8Vmlld0l0ZW1bXT5cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIHRoZSBhY3Rpb24gYnV0dG9ucyBvbiB0aGUgc2VjdGlvbidzIGhlYWRlclxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIGFycmF5IG9mIFZpZXdQYW5lbEFjdGlvbiBvYmplY3RzXG4gICAgICovXG4gICAgYXN5bmMgZ2V0QWN0aW9ucyAoKTogUHJvbWlzZTxWaWV3UGFuZWxBY3Rpb25bXT4ge1xuICAgICAgICBjb25zdCBhY3Rpb25zOiBWaWV3UGFuZWxBY3Rpb25bXSA9IFtdXG5cbiAgICAgICAgaWYgKCFhd2FpdCB0aGlzLmlzSGVhZGVySGlkZGVuKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gYXdhaXQgdGhpc1xuICAgICAgICAgICAgICAgIC5oZWFkZXIkXG4gICAgICAgICAgICAgICAgLiQodGhpcy5sb2NhdG9ycy5hY3Rpb25zKVxuICAgICAgICAgICAgICAgIC4kJCh0aGlzLmxvY2F0b3JzLmJ1dHRvbilcblxuICAgICAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgICAgICAgICAgICAgYWN0aW9ucy5wdXNoKFxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBuZXcgVmlld1BhbmVsQWN0aW9uKFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2NhdG9yTWFwLFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtYXJndW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQgYXMgYW55LFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpc1xuICAgICAgICAgICAgICAgICAgICApLndhaXQoKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWN0aW9uc1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlIGFuIGFjdGlvbiBidXR0b24gb24gdGhlIHNlY3Rpb25zJ3MgaGVhZGVyIGJ5IGl0cyBsYWJlbFxuICAgICAqIEBwYXJhbSBsYWJlbCBsYWJlbC90aXRsZSBvZiB0aGUgYnV0dG9uXG4gICAgICogQHJldHVybnMgVmlld1BhbmVsQWN0aW9uIG9iamVjdCBpZiBmb3VuZCwgdW5kZWZpbmVkIG90aGVyd2lzZVxuICAgICAqL1xuICAgIGFzeW5jIGdldEFjdGlvbiAobGFiZWw6IHN0cmluZyk6IFByb21pc2U8Vmlld1BhbmVsQWN0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgICAgIGNvbnN0IGFjdGlvbnMgPSBhd2FpdCB0aGlzLmdldEFjdGlvbnMoKVxuICAgICAgICBmb3IgKGNvbnN0IGFjdGlvbiBvZiBhY3Rpb25zKSB7XG4gICAgICAgICAgICBpZiAoYXdhaXQgYWN0aW9uLmdldExhYmVsKCkgPT09IGxhYmVsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDbGljayBvbiB0aGUgTW9yZSBBY3Rpb25zLi4uIGl0ZW0gaWYgaXQgZXhpc3RzXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBDb250ZXh0TWVudSBwYWdlIG9iamVjdCBpZiB0aGUgYWN0aW9uIHN1Y2NlZWRzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgbW9yZUFjdGlvbnMgKCk6IFByb21pc2U8Q29udGV4dE1lbnUgfCB1bmRlZmluZWQ+IHtcbiAgICAgICAgY29uc3QgbW9yZSA9IGF3YWl0IHRoaXMuZ2V0QWN0aW9uKCdNb3JlIEFjdGlvbnMuLi4nKVxuICAgICAgICBpZiAoIW1vcmUpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZWN0aW9uID0gdGhpc1xuICAgICAgICBjb25zdCBzZWxmID0gdGhpc1xuICAgICAgICBjb25zdCBidG4gPSBuZXcgY2xhc3MgZXh0ZW5kcyBFbGVtZW50V2l0aENvbnRleHRNZW51PHR5cGVvZiBWaWV3U2VjdGlvbkxvY2F0b3JzPiB7XG4gICAgICAgICAgICBsb2NhdG9yS2V5ID0gJ1ZpZXdTZWN0aW9uJyBhcyBjb25zdFxuXG4gICAgICAgICAgICBhc3luYyBvcGVuQ29udGV4dE1lbnUgKCkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuZWxlbS5jbGljaygpXG4gICAgICAgICAgICAgICAgY29uc3Qgc2hhZG93Um9vdEhvc3QgPSBhd2FpdCBzZWN0aW9uLmVsZW0uJCQoJy5zaGFkb3ctcm9vdC1ob3N0JylcbiAgICAgICAgICAgICAgICBpZiAoc2hhZG93Um9vdEhvc3QubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzaGFkb3dSb290ID0gJChhd2FpdCBicm93c2VyLmV4ZWN1dGUoJ3JldHVybiBhcmd1bWVudHNbMF0uc2hhZG93Um9vdCcsIHNoYWRvd1Jvb3RIb3N0WzBdKSlcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBDb250ZXh0TWVudShzZWxmLmxvY2F0b3JNYXAsIHNoYWRvd1Jvb3QpLndhaXQoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gc3VwZXIub3BlbkNvbnRleHRNZW51KClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSh0aGlzLmxvY2F0b3JNYXAsIG1vcmUuZWxlbSwgdGhpcy5lbGVtKVxuICAgICAgICByZXR1cm4gYnRuLm9wZW5Db250ZXh0TWVudSgpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBhc3luYyBpc0hlYWRlckhpZGRlbiAoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIHJldHVybiAoYXdhaXQgdGhpcy5oZWFkZXIkLmdldEF0dHJpYnV0ZSgnY2xhc3MnKSkuaW5kZXhPZignaGlkZGVuJykgPiAtMVxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBWaWV3UGFuZWxBY3Rpb24gZXh0ZW5kcyBJUGFnZURlY29yYXRvcjx0eXBlb2YgVmlld1NlY3Rpb25Mb2NhdG9ycz4geyB9XG4vKipcbiAqIEFjdGlvbiBidXR0b24gb24gdGhlIGhlYWRlciBvZiBhIHZpZXcgc2VjdGlvblxuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKFZpZXdTZWN0aW9uTG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgVmlld1BhbmVsQWN0aW9uIGV4dGVuZHMgQmFzZVBhZ2U8dHlwZW9mIFZpZXdTZWN0aW9uTG9jYXRvcnM+IHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHB1YmxpYyBsb2NhdG9yS2V5ID0gJ1ZpZXdTZWN0aW9uJyBhcyBjb25zdFxuXG4gICAgY29uc3RydWN0b3IgKFxuICAgICAgICBsb2NhdG9yczogVlNDb2RlTG9jYXRvck1hcCxcbiAgICAgICAgZWxlbWVudDogQ2hhaW5hYmxlUHJvbWlzZUVsZW1lbnQ8V2ViZHJpdmVySU8uRWxlbWVudD4sXG4gICAgICAgIHZpZXdQYXJ0OiBWaWV3U2VjdGlvblxuICAgICkge1xuICAgICAgICBzdXBlcihsb2NhdG9ycywgZWxlbWVudCwgdmlld1BhcnQuZWxlbSlcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbGFiZWwgb2YgdGhlIGFjdGlvbiBidXR0b25cbiAgICAgKi9cbiAgICBhc3luYyBnZXRMYWJlbCAoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbS5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9ycy5idXR0b25MYWJlbClcbiAgICB9XG5cbiAgICBhc3luYyB3YWl0ICh0aW1lb3V0ID0gMTAwMCk6IFByb21pc2U8dGhpcz4ge1xuICAgICAgICBhd2FpdCB0aGlzLmVsZW0ud2FpdEZvckVuYWJsZWQoeyB0aW1lb3V0IH0pXG4gICAgICAgIHJldHVybiB0aGlzXG4gICAgfVxufVxuIl19