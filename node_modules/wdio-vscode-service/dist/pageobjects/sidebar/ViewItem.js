var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { BasePage, ElementWithContextMenu, PageDecorator } from '../utils.js';
import { ViewSection as ViewSectionLocators } from '../../locators/1.73.0.js';
/**
 * Arbitrary item in the side bar view
 *
 * @category Sidebar
 */
export class ViewItem extends ElementWithContextMenu {
    /**
     * Select the item in the view.
     * Note that selecting the item will toggle its expand state when applicable.
     * @returns Promise resolving when the item has been clicked
     */
    async select() {
        await this.elem.click();
    }
}
/**
 * TreeItem abstract class
 *
 * @category Sidebar
 */
export class TreeItem extends ViewItem {
    /**
     * Finds if the item has children by actually counting the child items
     * Note that this will expand the item if it was collapsed
     * @returns Promise resolving to true/false
     */
    async hasChildren() {
        const children = await this.getChildren();
        return children && children.length > 0;
    }
    /**
     * Expands the current item, if it can be expanded and is collapsed.
     */
    async expand() {
        if (await this.isExpandable() && !await this.isExpanded()) {
            await this.twistie$.click();
        }
    }
    /**
     * Find a child item with the given name
     * @returns Promise resolving to TreeItem object if the child item exists, undefined otherwise
     */
    async findChildItem(name) {
        const children = await this.getChildren();
        for (const item of children) {
            if (await item.getLabel() === name) {
                return item;
            }
        }
        return undefined;
    }
    /**
     * Collapse the item if expanded
     */
    async collapse() {
        if (await this.isExpandable() && await this.isExpanded()) {
            await this.twistie$.click();
        }
    }
    /**
     * Find all action buttons bound to the view item
     *
     * @returns array of ViewItemAction objects, empty array if item has no
     * actions associated
     */
    async getActionButtons() {
        await this.elem.moveTo();
        const container = await this.actions$;
        if (!await container.isExisting()) {
            return [];
        }
        const actions = [];
        const items = await container.$$(this.locators.actionLabel);
        for (const item of items) {
            const elem = item.$(this.locatorMap.ViewSection.actionConstructor());
            const label = (
            // v1.69.0 and before
            await elem.getAttribute(this.locators.actionTitle)
                // v1.70.0 and after
                || await item.getAttribute(this.locators.actionTitle));
            actions.push(new ViewItemAction(this.locatorMap, elem, label, this));
        }
        return actions;
    }
    /**
     * Find action button for view item by label
     * @param label label of the button to search by
     *
     * @returns ViewItemAction object if such button exists, undefined otherwise
     */
    async getActionButton(label) {
        const actions = await this.getActionButtons();
        if (actions.length > 0) {
            for (const item of actions) {
                const itemLabel = item.getLabel() ?? await item.elem.getAttribute('aria-label');
                if (itemLabel.indexOf(label) > -1) {
                    return item;
                }
            }
        }
        return undefined;
    }
    /**
     * Find all child elements of a tree item
     * @param locator locator of a given type of tree item
     */
    async getChildItems(locator) {
        const items = [];
        await this.expand();
        const rows = await this.parent.$$(locator);
        const baseIndex = +await this.elem.getAttribute(this.locatorMap.ViewSection.index);
        const baseLevel = +await this.elem.getAttribute(this.locatorMap.ViewSection.level);
        for (const row of rows) {
            const level = +await row.getAttribute(this.locatorMap.ViewSection.level);
            const index = +await row.getAttribute(this.locatorMap.ViewSection.index);
            if (index <= baseIndex) {
                continue;
            }
            if (level > baseLevel + 1) {
                continue;
            }
            if (level <= baseLevel) {
                break;
            }
            items.push(row);
        }
        return items;
    }
    async findTwistie() {
        return this.twistie$;
    }
}
/**
 * Action button bound to a view item
 *
 * @category Sidebar
 */
let ViewItemAction = class ViewItemAction extends BasePage {
    constructor(locators, elem, label, viewItem) {
        super(locators, elem, viewItem.elem);
        /**
         * @private
         */
        this.locatorKey = 'ViewSection';
        this.label = label;
    }
    /**
     * Get label of the action button
     */
    getLabel() {
        return this.label;
    }
};
ViewItemAction = __decorate([
    PageDecorator(ViewSectionLocators)
], ViewItemAction);
export { ViewItemAction };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVmlld0l0ZW0uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcGFnZW9iamVjdHMvc2lkZWJhci9WaWV3SXRlbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7QUFDQSxPQUFPLEVBQ2EsUUFBUSxFQUFFLHNCQUFzQixFQUFFLGFBQWEsRUFDbEUsTUFBTSxhQUFhLENBQUE7QUFDcEIsT0FBTyxFQUNILFdBQVcsSUFBSSxtQkFBbUIsRUFLckMsTUFBTSwwQkFBMEIsQ0FBQTtBQWVqQzs7OztHQUlHO0FBQ0gsTUFBTSxPQUFnQixRQUFTLFNBQVEsc0JBQXdDO0lBQzNFOzs7O09BSUc7SUFDSCxLQUFLLENBQUMsTUFBTTtRQUNSLE1BQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQTtJQUMzQixDQUFDO0NBQ0o7QUFHRDs7OztHQUlHO0FBQ0gsTUFBTSxPQUFnQixRQUFTLFNBQVEsUUFBUTtJQWtCM0M7Ozs7T0FJRztJQUNILEtBQUssQ0FBQyxXQUFXO1FBQ2IsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUE7UUFDekMsT0FBTyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUE7SUFDMUMsQ0FBQztJQW9CRDs7T0FFRztJQUNILEtBQUssQ0FBQyxNQUFNO1FBQ1IsSUFBSSxNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxFQUFFLENBQUM7WUFDeEQsTUFBTSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFBO1FBQy9CLENBQUM7SUFDTCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0gsS0FBSyxDQUFDLGFBQWEsQ0FBRSxJQUFZO1FBQzdCLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFBO1FBQ3pDLEtBQUssTUFBTSxJQUFJLElBQUksUUFBUSxFQUFFLENB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QUFHLEtBQUssQ0FBQTtJQUN0QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxRQUFRO1FBQ0osT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFBO0lBQ3JCLENBQUM7Q0FDSixDQUFBO0FBdkJZLGNBQWM7SUFEMUIsYUFBYSxDQUFDLG1CQUFtQixDQUFDO0dBQ3RCLGNBQWMsQ0F1QjFCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDaGFpbmFibGVQcm9taXNlRWxlbWVudCB9IGZyb20gJ3dlYmRyaXZlcmlvJ1xuaW1wb3J0IHtcbiAgICBJUGFnZURlY29yYXRvciwgQmFzZVBhZ2UsIEVsZW1lbnRXaXRoQ29udGV4dE1lbnUsIFBhZ2VEZWNvcmF0b3IsIFZTQ29kZUxvY2F0b3JNYXBcbn0gZnJvbSAnLi4vdXRpbHMuanMnXG5pbXBvcnQge1xuICAgIFZpZXdTZWN0aW9uIGFzIFZpZXdTZWN0aW9uTG9jYXRvcnMsXG4gICAgVHJlZUl0ZW0gYXMgVHJlZUl0ZW1Mb2NhdG9ycyxcbiAgICBDdXN0b21UcmVlSXRlbSBhcyBDdXN0b21UcmVlSXRlbUxvY2F0b3JzLFxuICAgIERlZmF1bHRUcmVlSXRlbSBhcyBEZWZhdWx0VHJlZUl0ZW1Mb2NhdG9ycyxcbiAgICBFeHRlbnNpb25zVmlld0l0ZW0gYXMgRXh0ZW5zaW9uc1ZpZXdJdGVtTG9jYXRvcnNcbn0gZnJvbSAnLi4vLi4vbG9jYXRvcnMvMS43My4wLmpzJ1xuXG4vKipcbiAqIEFic3RyYWN0IHJlcHJlc2VudGF0aW9uIG9mIGEgcm93IGluIHRoZSB0cmVlIGluc2lkZSBhIHZpZXcgY29udGVudCBzZWN0aW9uXG4gKiBAaGlkZGVuXG4gKi9cbmV4cG9ydCB0eXBlIFZpZXdJdGVtTG9jYXRvcnMgPSAoXG4gICAgdHlwZW9mIFZpZXdTZWN0aW9uTG9jYXRvcnMgJlxuICAgIHR5cGVvZiBUcmVlSXRlbUxvY2F0b3JzICZcbiAgICB0eXBlb2YgQ3VzdG9tVHJlZUl0ZW1Mb2NhdG9ycyAmXG4gICAgdHlwZW9mIERlZmF1bHRUcmVlSXRlbUxvY2F0b3JzICZcbiAgICB0eXBlb2YgRXh0ZW5zaW9uc1ZpZXdJdGVtTG9jYXRvcnNcbilcblxuZXhwb3J0IGludGVyZmFjZSBWaWV3SXRlbSBleHRlbmRzIElQYWdlRGVjb3JhdG9yPFZpZXdJdGVtTG9jYXRvcnM+IHsgfVxuLyoqXG4gKiBBcmJpdHJhcnkgaXRlbSBpbiB0aGUgc2lkZSBiYXIgdmlld1xuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBWaWV3SXRlbSBleHRlbmRzIEVsZW1lbnRXaXRoQ29udGV4dE1lbnU8Vmlld0l0ZW1Mb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIFNlbGVjdCB0aGUgaXRlbSBpbiB0aGUgdmlldy5cbiAgICAgKiBOb3RlIHRoYXQgc2VsZWN0aW5nIHRoZSBpdGVtIHdpbGwgdG9nZ2xlIGl0cyBleHBhbmQgc3RhdGUgd2hlbiBhcHBsaWNhYmxlLlxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHdoZW4gdGhlIGl0ZW0gaGFzIGJlZW4gY2xpY2tlZFxuICAgICAqL1xuICAgIGFzeW5jIHNlbGVjdCAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGF3YWl0IHRoaXMuZWxlbS5jbGljaygpXG4gICAgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyZWVJdGVtIGV4dGVuZHMgSVBhZ2VEZWNvcmF0b3I8Vmlld0l0ZW1Mb2NhdG9ycz4geyB9XG4vKipcbiAqIFRyZWVJdGVtIGFic3RyYWN0IGNsYXNzXG4gKlxuICogQGNhdGVnb3J5IFNpZGViYXJcbiAqL1xuZXhwb3J0IGFic3RyYWN0IGNsYXNzIFRyZWVJdGVtIGV4dGVuZHMgVmlld0l0ZW0ge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyB0aGUgbGFiZWwgb2YgdGhpcyB2aWV3IGl0ZW1cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXRMYWJlbCAoKTogUHJvbWlzZTxzdHJpbmc+XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIHRvb2x0aXAgb2YgdGhpcyBUcmVlSXRlbS5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgcmVzb2x2aW5nIHRvIHRoZSB0b29sdGlwIG9yIHVuZGVmaW5lZCBpZiB0aGUgVHJlZUl0ZW0gaGFzIG5vIHRvb2x0aXAuXG4gICAgICovXG4gICAgYWJzdHJhY3QgZ2V0VG9vbHRpcCAoKTogUHJvbWlzZTxzdHJpbmcgfCB1bmRlZmluZWQ+XG5cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGRlc2NyaXB0aW9uIG9mIHRoaXMgVHJlZUl0ZW0uXG4gICAgICogQHJldHVybnMgQSBwcm9taXNlIHJlc29sdmluZyB0byB0aGUgdG9vbHRpcCBvciB1bmRlZmluZWQgaWYgdGhlIFRyZWVJdGVtIGhhcyBubyBkZXNjcmlwdGlvbi5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXREZXNjcmlwdGlvbiAoKTogUHJvbWlzZTxzdHJpbmcgfCB1bmRlZmluZWQ+XG5cbiAgICAvKipcbiAgICAgKiBGaW5kcyBpZiB0aGUgaXRlbSBoYXMgY2hpbGRyZW4gYnkgYWN0dWFsbHkgY291bnRpbmcgdGhlIGNoaWxkIGl0ZW1zXG4gICAgICogTm90ZSB0aGF0IHRoaXMgd2lsbCBleHBhbmQgdGhlIGl0ZW0gaWYgaXQgd2FzIGNvbGxhcHNlZFxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUvZmFsc2VcbiAgICAgKi9cbiAgICBhc3luYyBoYXNDaGlsZHJlbiAoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gYXdhaXQgdGhpcy5nZXRDaGlsZHJlbigpXG4gICAgICAgIHJldHVybiBjaGlsZHJlbiAmJiBjaGlsZHJlbi5sZW5ndGggPiAwXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZHMgd2hldGhlciB0aGUgaXRlbSBpcyBleHBhbmRlZC4gQWx3YXlzIHJldHVybnMgZmFsc2UgaWYgaXRlbSBoYXMgbm8gY2hpbGRyZW4uXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gdHJ1ZS9mYWxzZVxuICAgICAqL1xuICAgIGFic3RyYWN0IGlzRXhwYW5kZWQgKCk6IFByb21pc2U8Ym9vbGVhbj5cblxuICAgIC8qKlxuICAgICAqIEZpbmQgY2hpbGRyZW4gb2YgYW4gaXRlbSwgd2lsbCB0cnkgdG8gZXhwYW5kIHRoZSBpdGVtIGluIHRoZSBwcm9jZXNzXG4gICAgICogQHJldHVybnMgUHJvbWlzZSByZXNvbHZpbmcgdG8gYXJyYXkgb2YgVHJlZUl0ZW0gb2JqZWN0cywgZW1wdHkgYXJyYXkgaWYgaXRlbSBoYXMgbm8gY2hpbGRyZW5cbiAgICAgKi9cbiAgICBhYnN0cmFjdCBnZXRDaGlsZHJlbiAoKTogUHJvbWlzZTxUcmVlSXRlbVtdPlxuXG4gICAgLyoqXG4gICAgICogRmluZHMgaWYgdGhlIGl0ZW0gaXMgZXhwYW5kYWJsZS9jb2xsYXBzaWJsZVxuICAgICAqIEByZXR1cm5zIFByb21pc2UgcmVzb2x2aW5nIHRvIHRydWUvZmFsc2VcbiAgICAgKi9cbiAgICBhYnN0cmFjdCBpc0V4cGFuZGFibGUgKCk6IFByb21pc2U8Ym9vbGVhbj5cblxuICAgIC8qKlxuICAgICAqIEV4cGFuZHMgdGhlIGN1cnJlbnQgaXRlbSwgaWYgaXQgY2FuIGJlIGV4cGFuZGVkIGFuZCBpcyBjb2xsYXBzZWQuXG4gICAgICovXG4gICAgYXN5bmMgZXhwYW5kICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNFeHBhbmRhYmxlKCkgJiYgIWF3YWl0IHRoaXMuaXNFeHBhbmRlZCgpKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnR3aXN0aWUkLmNsaWNrKClcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYSBjaGlsZCBpdGVtIHdpdGggdGhlIGdpdmVuIG5hbWVcbiAgICAgKiBAcmV0dXJucyBQcm9taXNlIHJlc29sdmluZyB0byBUcmVlSXRlbSBvYmplY3QgaWYgdGhlIGNoaWxkIGl0ZW0gZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgZmluZENoaWxkSXRlbSAobmFtZTogc3RyaW5nKTogUHJvbWlzZTxUcmVlSXRlbSB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGF3YWl0IHRoaXMuZ2V0Q2hpbGRyZW4oKVxuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgY2hpbGRyZW4pIHtcbiAgICAgICAgICAgIGlmIChhd2FpdCBpdGVtLmdldExhYmVsKCkgPT09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaXRlbVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDb2xsYXBzZSB0aGUgaXRlbSBpZiBleHBhbmRlZFxuICAgICAqL1xuICAgIGFzeW5jIGNvbGxhcHNlICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGF3YWl0IHRoaXMuaXNFeHBhbmRhYmxlKCkgJiYgYXdhaXQgdGhpcy5pc0V4cGFuZGVkKCkpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudHdpc3RpZSQuY2xpY2soKVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRmluZCBhbGwgYWN0aW9uIGJ1dHRvbnMgYm91bmQgdG8gdGhlIHZpZXcgaXRlbVxuICAgICAqXG4gICAgICogQHJldHVybnMgYXJyYXkgb2YgVmlld0l0ZW1BY3Rpb24gb2JqZWN0cywgZW1wdHkgYXJyYXkgaWYgaXRlbSBoYXMgbm9cbiAgICAgKiBhY3Rpb25zIGFzc29jaWF0ZWRcbiAgICAgKi9cbiAgICBhc3luYyBnZXRBY3Rpb25CdXR0b25zICgpOiBQcm9taXNlPFZpZXdJdGVtQWN0aW9uW10+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5lbGVtLm1vdmVUbygpXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGF3YWl0IHRoaXMuYWN0aW9ucyRcblxuICAgICAgICBpZiAoIWF3YWl0IGNvbnRhaW5lci5pc0V4aXN0aW5nKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWN0aW9uczogVmlld0l0ZW1BY3Rpb25bXSA9IFtdXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gYXdhaXQgY29udGFpbmVyLiQkKHRoaXMubG9jYXRvcnMuYWN0aW9uTGFiZWwpXG4gICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBpdGVtcykge1xuICAgICAgICAgICAgY29uc3QgZWxlbSA9IGl0ZW0uJCgodGhpcy5sb2NhdG9yTWFwLlZpZXdTZWN0aW9uLmFjdGlvbkNvbnN0cnVjdG9yIGFzICgpID0+IHN0cmluZykoKSlcbiAgICAgICAgICAgIGNvbnN0IGxhYmVsID0gKFxuICAgICAgICAgICAgICAgIC8vIHYxLjY5LjAgYW5kIGJlZm9yZVxuICAgICAgICAgICAgICAgIGF3YWl0IGVsZW0uZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvcnMuYWN0aW9uVGl0bGUpXG4gICAgICAgICAgICAgICAgLy8gdjEuNzAuMCBhbmQgYWZ0ZXJcbiAgICAgICAgICAgICAgICB8fCBhd2FpdCBpdGVtLmdldEF0dHJpYnV0ZSh0aGlzLmxvY2F0b3JzLmFjdGlvblRpdGxlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgYWN0aW9ucy5wdXNoKG5ldyBWaWV3SXRlbUFjdGlvbih0aGlzLmxvY2F0b3JNYXAsIGVsZW0sIGxhYmVsLCB0aGlzKSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYWN0aW9uc1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpbmQgYWN0aW9uIGJ1dHRvbiBmb3IgdmlldyBpdGVtIGJ5IGxhYmVsXG4gICAgICogQHBhcmFtIGxhYmVsIGxhYmVsIG9mIHRoZSBidXR0b24gdG8gc2VhcmNoIGJ5XG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBWaWV3SXRlbUFjdGlvbiBvYmplY3QgaWYgc3VjaCBidXR0b24gZXhpc3RzLCB1bmRlZmluZWQgb3RoZXJ3aXNlXG4gICAgICovXG4gICAgYXN5bmMgZ2V0QWN0aW9uQnV0dG9uIChsYWJlbDogc3RyaW5nKTogUHJvbWlzZTxWaWV3SXRlbUFjdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgICAgICBjb25zdCBhY3Rpb25zID0gYXdhaXQgdGhpcy5nZXRBY3Rpb25CdXR0b25zKClcbiAgICAgICAgaWYgKGFjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIG9mIGFjdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBpdGVtTGFiZWwgPSBpdGVtLmdldExhYmVsKCkgPz8gYXdhaXQgaXRlbS5lbGVtLmdldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW1MYWJlbC5pbmRleE9mKGxhYmVsKSA+IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBGaW5kIGFsbCBjaGlsZCBlbGVtZW50cyBvZiBhIHRyZWUgaXRlbVxuICAgICAqIEBwYXJhbSBsb2NhdG9yIGxvY2F0b3Igb2YgYSBnaXZlbiB0eXBlIG9mIHRyZWUgaXRlbVxuICAgICAqL1xuICAgIHByb3RlY3RlZCBhc3luYyBnZXRDaGlsZEl0ZW1zIChsb2NhdG9yOiBzdHJpbmcpIHtcbiAgICAgICAgY29uc3QgaXRlbXM6IFdlYmRyaXZlcklPLkVsZW1lbnRbXSA9IFtdXG4gICAgICAgIGF3YWl0IHRoaXMuZXhwYW5kKClcblxuICAgICAgICBjb25zdCByb3dzID0gYXdhaXQgdGhpcy5wYXJlbnQuJCQobG9jYXRvcilcbiAgICAgICAgY29uc3QgYmFzZUluZGV4ID0gK2F3YWl0IHRoaXMuZWxlbS5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9yTWFwLlZpZXdTZWN0aW9uLmluZGV4IGFzIHN0cmluZylcbiAgICAgICAgY29uc3QgYmFzZUxldmVsID0gK2F3YWl0IHRoaXMuZWxlbS5nZXRBdHRyaWJ1dGUodGhpcy5sb2NhdG9yTWFwLlZpZXdTZWN0aW9uLmxldmVsIGFzIHN0cmluZylcblxuICAgICAgICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XG4gICAgICAgICAgICBjb25zdCBsZXZlbCA9ICthd2FpdCByb3cuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvck1hcC5WaWV3U2VjdGlvbi5sZXZlbCBhcyBzdHJpbmcpXG4gICAgICAgICAgICBjb25zdCBpbmRleCA9ICthd2FpdCByb3cuZ2V0QXR0cmlidXRlKHRoaXMubG9jYXRvck1hcC5WaWV3U2VjdGlvbi5pbmRleCBhcyBzdHJpbmcpXG5cbiAgICAgICAgICAgIGlmIChpbmRleCA8PSBiYXNlSW5kZXgpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxldmVsID4gYmFzZUxldmVsICsgMSkge1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobGV2ZWwgPD0gYmFzZUxldmVsKSB7XG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaXRlbXMucHVzaChyb3cpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gaXRlbXNcbiAgICB9XG5cbiAgICBwcm90ZWN0ZWQgYXN5bmMgZmluZFR3aXN0aWUgKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50d2lzdGllJFxuICAgIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBWaWV3SXRlbUFjdGlvbiBleHRlbmRzIElQYWdlRGVjb3JhdG9yPHR5cGVvZiBWaWV3U2VjdGlvbkxvY2F0b3JzPiB7IH1cbi8qKlxuICogQWN0aW9uIGJ1dHRvbiBib3VuZCB0byBhIHZpZXcgaXRlbVxuICpcbiAqIEBjYXRlZ29yeSBTaWRlYmFyXG4gKi9cbkBQYWdlRGVjb3JhdG9yKFZpZXdTZWN0aW9uTG9jYXRvcnMpXG5leHBvcnQgY2xhc3MgVmlld0l0ZW1BY3Rpb24gZXh0ZW5kcyBCYXNlUGFnZTx0eXBlb2YgVmlld1NlY3Rpb25Mb2NhdG9ycz4ge1xuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgcHVibGljIGxvY2F0b3JLZXkgPSAnVmlld1NlY3Rpb24nIGFzIGNvbnN0XG4gICAgcHJpdmF0ZSBsYWJlbDogc3RyaW5nXG5cbiAgICBjb25zdHJ1Y3RvciAoXG4gICAgICAgIGxvY2F0b3JzOiBWU0NvZGVMb2NhdG9yTWFwLFxuICAgICAgICBlbGVtOiBDaGFpbmFibGVQcm9taXNlRWxlbWVudDxXZWJkcml2ZXJJTy5FbGVtZW50PixcbiAgICAgICAgbGFiZWw6IHN0cmluZyxcbiAgICAgICAgdmlld0l0ZW06IFRyZWVJdGVtXG4gICAgKSB7XG4gICAgICAgIHN1cGVyKGxvY2F0b3JzLCBlbGVtLCB2aWV3SXRlbS5lbGVtKVxuICAgICAgICB0aGlzLmxhYmVsID0gbGFiZWxcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBHZXQgbGFiZWwgb2YgdGhlIGFjdGlvbiBidXR0b25cbiAgICAgKi9cbiAgICBnZXRMYWJlbCAoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGFiZWxcbiAgICB9XG59XG4iXX0=